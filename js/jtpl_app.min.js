$(window).load(function(){$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=2",crossDomain:!0,data:{val:"X"},error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(){},error:function(){console.error("error"),alert("Not working!")}})}),$(window).load(function(){var e;$(document).on("pageshow","#direction",function(){e=new GMaps({div:"#map_canvas",lat:41.0205399,lng:-74.5490396,width:"100%",height:"250px",zoom:15,zoomControl:!0,zoomControlOpt:{style:"SMALL",position:"TOP_LEFT"},panControl:!1}),e.addMarker({lat:41.0205399,lng:-74.5490396,title:"JTPL",infoWindow:{content:"<p>Jefferson Township Public Library, 1031 Weldon Road, Oak Ridge, NJ 07438</p>"}})})}),$(document).ready(function(){function e(){window.plugins.spinnerDialog.show()}function t(){window.plugins.spinnerDialog.hide()}function o(e,t,o){$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=5",crossDomain:!0,data:{ControlID:t,PatronID:e},error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(e){var e=jQuery.parseJSON(e);r(o)},error:function(){console.error("error"),alert("Not working!")}})}function r(e){searchitem1=e,searchitem2=$("#libpin").val(),$.mobile.changePage("#inside"),$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=7",crossDomain:!0,data:{PatronBarcode:searchitem1,libpin:searchitem2},error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(e){var e=jQuery.parseJSON(e),t="",o=["Title","Author","StatusDescription","HoldRequestID"];$("#loginresponse").empty(),$.each(e.PatronHoldRequestsGetRows,function(e,r){"Cancelled"!=r.StatusDescription&&(t+='<table class="bibtbl"><tr><td class="picbox"></td><td class="txtbox">',$.each(r,function(e,r){""!=r&&-1!==jQuery.inArray(e,o)&&(t+="Title"==e?"<strong>"+e+": "+r+"</strong><br>":e+": "+r+"<br>","HoldRequestID"==e&&(hold_req_id=r))}),t+="<p class='hold_cancel'><a id="+hold_req_id+" href='#inside'>Cancel Hold</a></p>",t+="</td></tr></table>")}),$("#loginresponse").append(t)},error:function(){console.error("error"),alert("Not working!")}})}function n(e,t,o){searchitem1=$("#libpin").val(),searchitem2=o,searchitem3=t,$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=6",crossDomain:!0,data:{PatronBarcode:searchitem3,hold_id:searchitem2,libpin:searchitem1},error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(){$("#loginresponse").empty(),a(t,o)},error:function(){console.error("error"),alert("Not working!")}})}function a(e,t){searchitem1=e,searchitem2=$("#libpin").val(),$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=7",crossDomain:!0,data:{PatronBarcode:searchitem1,libpin:searchitem2},error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(e){$("#loginresponse").empty();var e=jQuery.parseJSON(e),o="",r=["Title","Author","StatusDescription"];$("#loginresponse").empty(),$.each(e.PatronHoldRequestsGetRows,function(e,n){"Cancelled"!=n.StatusDescription&&(o+='<table class="bibtbl"><tr><td class="picbox"></td><td class="txtbox">',$.each(n,function(e,t){""!=t&&-1!==jQuery.inArray(e,r)&&(o+="Title"==e?"<strong>"+e+": "+t+"</strong><br>":e+": "+t+"<br>")}),o+="<p class='hold_cancel'><a id="+t+"href='#inside'>Cancel Hold</a></p>",o+="</td></tr></table>")}),$("#loginresponse").append(o)},error:function(){console.error("error"),alert("Not working!")}})}function i(){$.mobile.changePage("#inside")}$("#dir_start").on("tap",function(){e(),launchnavigator.navigate([41.0204913,-74.549163],null,function(){t()},function(e){alert("Directions can not be generated."+e)})}),$("#search_item").on("keyup",function(){searchitem=0,searchitem=$("#search_item").val(),$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=2",crossDomain:!0,data:{val:searchitem},error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(e){var e=jQuery.parseJSON(e),t=["Title","Author","PublicationDate","LocalItemsIn","CurrentHoldRequests"];$("#blist").empty();var o="";$.each(e.BibSearchRows,function(e,r){cont_no=r.ControlNumber,ISBN=r.ISBN,o+='<table class="bibtbl"><tr><td class="picbox"><img src="http://contentcafe2.btol.com/ContentCafe/Jacket.aspx?Return=T&Type=S&Value='+ISBN+'&userID=MAIN37789&password=CC10073" /></td ><td class="txtbox">',$.each(r,function(e,r){""!=r&&-1!==jQuery.inArray(e,t)&&(o+=e+": "+r+"<br>")}),o+="<p class='trail'><a id="+cont_no+" href='#bib_detail'>Detail</a></p>",o+="</td></tr></table>"}),$("#blist").append(o)},error:function(){console.error("error"),alert("Not working!")}})}),$(document).on("click",".trail a",function(){searchitem=$(this).attr("id");$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=3",crossDomain:!0,data:{val:searchitem},error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(e){var e=jQuery.parseJSON(e),t=["Title","Author","PublicationDate","LocalItemsIn","CurrentHoldRequests","Summary"];$("#bdetail").empty();var o="";o+="<H3>Title Detail</H3>",$.each(e.BibSearchRows,function(e,r){cont_no=r.ControlNumber,ISBN=r.ISBN,o+='<table class="bibtbl"><tr><td class="picbox"><img src="http://contentcafe2.btol.com/ContentCafe/Jacket.aspx?Return=T&Type=S&Value='+ISBN+'&userID=MAIN37789&password=CC10073" /></td ><td class="txtbox">',$.each(r,function(e,r){""!=r&&-1!==jQuery.inArray(e,t)&&(o+=e+": "+r+"<br>")}),o+="<p class='hold_req'><a id="+cont_no+" href='#login'>Put on Hold</a></p>",o+="</td></tr></table>"}),$("#bdetail").append(o)},error:function(){console.error("error"),alert("Not working!")}})}),$("#loginsubmitxx").on("click",function(){$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=4",crossDomain:!0,data:form.serialize(),error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(e){$("#loginresponse").empty();{var e=jQuery.parseJSON(e),t=(e.PatronID,e.ValidPatron);e.Barcode}1==t?i():$("#loginresponse").append(t)},error:function(){console.error("error"),alert("Not working!")}})}),$(document).on("click",".hold_req a",function(){cont_num=$(this).attr("id"),$("#cn_holdreq").val(cont_num)}),$("#loginsubmit").on("click",function(){var e,t=$("#loginform");e=$("#cn_holdreq").val()?!0:!1,$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=4",crossDomain:!0,data:t.serialize(),error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(t){{var t=jQuery.parseJSON(t),n=t.PatronID,a=t.PatronBarcode;t.ValidPatron}e?(o(n,cont_num,a),$("#cn_holdreq").val("")):r(a)},error:function(){console.error("error"),alert("Not working!")}})}),$(document).on("click",".hold_cancel a",function(){hold_id=$(this).attr("id");var e=$("#loginform");$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=4",crossDomain:!0,data:e.serialize(),error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(e){$("#loginresponse").empty();var e=jQuery.parseJSON(e),t=e.PatronID,o=e.PatronBarcode;n(t,o,hold_id)},error:function(){console.error("error"),alert("Not working!")}})}),$("#flashlight").on("click",function(){$(".ui-grid-solo .flash .ui-btn").css({"background-color":"#FDF000"}),window.plugins.flashlight.available(function(e){e?(window.plugins.flashlight.switchOn(),setTimeout(function(){window.plugins.flashlight.switchOff(),$(".ui-grid-solo .flash .ui-btn").css({"background-color":"#FFF7B7"})},5e3)):alert("Flashlight not available on this device")})}),$(document).on("click","#thesearch",function(){searchitem="x",$.ajax({type:"POST",url:"http://www.jeffersonlibrary.net/INTERMED.php?rq=8",crossDomain:!0,data:{val:searchitem},error:function(){alert("no connection")},timeout:6e4,cache:!1,success:function(e){var e=jQuery.parseJSON(e),t=["Title","Author","PublicationDate","LocalItemsIn","CurrentHoldRequests"];$("#news").empty();var o="";o+="<H3>New Publications</H3>",$.each(e.BibSearchRows,function(e,r){cont_no=r.ControlNumber,ISBN=r.ISBN,o+='<table class="bibtbl"><tr><td class="picbox"><img src="http://contentcafe2.btol.com/ContentCafe/Jacket.aspx?Return=T&Type=S&Value='+ISBN+'&userID=MAIN37789&password=CC10073" /></td ><td class="txtbox">',$.each(r,function(e,r){""!=r&&-1!==jQuery.inArray(e,t)&&(o+="Title"==e?"<strong>"+e+": "+r+"</strong><br>":e+": "+r+"<br>")}),o+="<p class='trail'><a id='"+cont_no+"' href='#bib_detail'>Detail</a></p>",o+="</td></tr></table>"}),$("#news").append(o)},error:function(){console.error("error"),alert("Not working!")}})}),window.addEventListener("load",function(){FastClick.attach(document.body)},!1)});